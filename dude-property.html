<!--
Copyright (c) 2015 DudeTeam. All rights reserved.
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="dude-property-string.html">
<!--
`dude-property` A generic picker which adapts automatically according to the type of the given value.

@group dude Elements
@element dude-property
@demo demo/index.html
-->
<dom-module id="dude-property">
    <style include="iron-flex"></style>
    <template>
        <fieldset>
            <div id="property"></div>
            <div>
                Value: <span>{{ propertyValue }}</span>
            </div>
        </fieldset>
        <br/>
    </template>
    <script>
        Polymer({
            is: "dude-property",
            properties: {
                /**
                 *
                 */
                "propertyTypes": {
                    "type": Object,
                    "value": {
                        "String": "dude-resource-string",
                        "Number": "dude-resource-string"
                    }
                },

                /**
                 *
                 */
                "propertyType": {
                    "type": String,
                    "observer": "_propertyTypeChanged"
                },

                /**
                 *
                 */
                "propertyName": {
                    "type": String
                },

                /**
                 *
                 */
                "propertyData": {
                    "type": Object
                },

                /**
                 *
                 */
                "propertyValue": {
                    "type": Object,
                    "observer": "_propertyValueChanged"
                }
            },
            listeners: {
                "dude-property-ready": "propertyReady",
                "dude-property-update": "propertyValueUpdate"
            },

            /**
             *
             */
            _propertyCustomElementReady: false,
            _propertyCustomElement: null,

            /**
             *
             */
            _propertyTypeChanged: function (propertyType) {
                if (this._propertyCustomElement !== null && this._propertyCustomElement.get("propertyType") !== propertyType) {
                    this.$.property.removeChild(this._propertyCustomElement);
                    this._propertyCustomElement = null;
                    this.set("_propertyCustomElementReady", false);
                }
                if (this._propertyCustomElement === null) {
                    var propertyCustomElement = this.get("propertyTypes")[propertyType];
                    if (typeof propertyCustomElement === "undefined") {
                        console.warn("`" + propertyType + "` not managed");
                        return;
                    }
                    this._propertyCustomElement = document.createElement("dude-property-string");
                    this.$.property.appendChild(this._propertyCustomElement);
                }
            },

            _propertyValueChanged: function (propertyValue) {

                this._propertyCustomElement.setPropertyValue(this.get("propertyValue"));
            },

            /**
             * Called when the property is ready
             */
            propertyReady: function () {
                this.set("_propertyCustomElementReady", true);
                this._propertyCustomElement.set("propertyType", this.get("propertyType"));
                this._propertyCustomElement.set("propertyName", this.get("propertyName"));
                this._propertyCustomElement.set("propertyData", this.get("propertyData"));
                this._propertyCustomElement.setPropertyValue(this.get("propertyValue"));
            },

            /**
             * Called when the propertyValue is updated
             */
            propertyValueUpdate: function () {
                if (this.get("_propertyCustomElementReady", true)) {
                    this.set("propertyValue", this._propertyCustomElement.get("propertyValue"));
                }
            }
        });
    </script>
</dom-module>