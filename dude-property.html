<!--
Copyright (c) 2015 DudeTeam. All rights reserved.
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../iron-input/iron-input.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-slider/paper-slider.html">
<link rel="import" href="../paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../dude-resource/dude-resource.html">
<link rel="import" href="../iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="dude-property-reference.html">
<!--
`dude-property` A generic picker which adapts automatically according to the type of the given value.

@group dude Elements
@element dude-property
@demo demo/index.html
-->
<dom-module id="dude-property">
    <style>
        :host {
            display: block;
            padding: 10px 0;
            --dude-property-label-color: #888888;

            /* Slider style */
            --paper-slider-active-color: var(--dude-primary-color);
            --paper-slider-secondary-color: var(--dude-primary-color);
            --paper-slider-knob-color: var(--dude-primary-color);
            --paper-slider-pin-color: var(--dude-primary-color);
            --paper-slider-font-color: var(--dude-primary-text-color);
            /* Dropdown style */
            --paper-dropdown-menu-input: {
                 font-family: var(--dude-content-text-font);
             };
            --paper-input-container-input-color: var(--dude-content-text-color);
            --paper-item: {
                 color: var(--dude-content-text-color);
                 font-weight: normal;
                font-family: var(--dude-content-text-font);
            };
            --paper-menu: {
                background: var(--dude-primary-background-color);
            };
            --paper-dropdown-menu-button: {
                padding: 0;
            };
            --paper-dropdown-menu-ripple: {
                top: 0;
                right: 0;
                bottom: 6px;
                left: 0;
            };
            --default-primary-color: var(--dude-primary-color);
        }

        label {
            display: block;
            padding-bottom: 5px;
            font-family: var(--dude-primary-text-font);
            color: var(--dude-property-label-color);
            font-size: .8em;
        }

        input[type="text"], input[type="number"] {
            color: var(--dude-content-text-color);
            background: transparent;
            border: none;
            border-bottom: 1px solid var(--dude-property-label-color);
            outline: none;
            font-size: 1em;
            font-family: var(--dude-content-text-font);
        }

        input[type="text"]:not(:first-child), input[type="number"]:not(:first-child) {
            margin-left: 10px;
        }

        input[type="text"]:focus, input[type="number"]:focus {
            border-bottom: 2px solid var(--dude-primary-color);
        }

        paper-button {
            text-transform: none;
            text-align: left;
            margin: 0;
            background: #444444;
            border-radius: 0;
        }
        #picker {
            height: 32px;
        }
    </style>
    <template>
        <label>[[ propertyName ]]</label>
        <div id="picker" class="layout horizontal">
            <!--<iron-pages attr-for-selected="data-type" selected="[[ propertyType ]]" class="layout horizontal flex">-->
                <template is="dom-if" if="[[ !propertyReference ]]" restamp>
                    <template is="dom-if" if="[[ _isType('choice') ]]" restamp>
                        <div data-type="choice" class="layout horizontal flex">
                            <paper-dropdown-menu no-label-float>
                                <paper-menu class="dropdown-content" attr-for-selected="name" selected="{{ propertyValue }}">
                                    <template is="dom-repeat" items="[[ propertyChoice ]]">
                                        <paper-item name="[[ item ]]">[[ item ]]</paper-item>
                                    </template>
                                </paper-menu>
                            </paper-dropdown-menu>
                        </div>
                    </template>
                    <template is="dom-if" if="[[ _isType('vec4') ]]" restamp>
                        <div class="layout horizontal flex">
                            <input is="input" value="{{ propertyValue.x::input }}" bind-value="{{ propertyValue.x }}" placeholder="x" class="flex" type="number">
                            <input is="input" value="{{ propertyValue.y::input }}" bind-value="{{ propertyValue.y }}" placeholder="y" class="flex" type="number">
                            <input is="input" value="{{ propertyValue.z::input }}" bind-value="{{ propertyValue.z }}" placeholder="z" class="flex" type="number">
                            <input is="input" value="{{ propertyValue.w::input }}" bind-value="{{ propertyValue.w }}" placeholder="w" class="flex" type="number">
                        </div>
                    </template>
                    <template is="dom-if" if="[[ _isType('vec3') ]]" restamp>
                        <div class="layout horizontal flex">
                            <input is="input" value="{{ propertyValue.x::input }}" bind-value="{{ propertyValue.x }}" placeholder="x" class="flex" type="number">
                            <input is="input" value="{{ propertyValue.y::input }}" bind-value="{{ propertyValue.y }}" placeholder="y" class="flex" type="number">
                            <input is="input" value="{{ propertyValue.z::input }}" bind-value="{{ propertyValue.z }}" placeholder="z" class="flex" type="number">
                        </div>
                    </template>
                    <template is="dom-if" if="[[ _isType('vec2') ]]" restamp>
                        <div class="layout horizontal flex">
                            <input is="input" value="{{ propertyValue.x::input }}" bind-value="{{ propertyValue.x }}" placeholder="x" class="flex" type="number">
                            <input is="input" value="{{ propertyValue.y::input }}" bind-value="{{ propertyValue.y }}" placeholder="y" class="flex" type="number">
                        </div>
                    </template>
                    <template is="dom-if" if="[[ _isType('number') ]]" restamp>
                        <div class="layout horizontal flex">
                            <input is="input" value="{{ propertyValue::input }}" bind-value="{{ propertyValue }}" class="flex" type="number">
                        </div>
                    </template>
                    <template is="dom-if" if="[[ _isType('string') ]]" restamp>
                        <div class="layout horizontal flex">
                            <input is="input" value="{{ propertyValue::input }}" bind-value="{{ propertyValue }}" class="flex" type="text">
                        </div>
                    </template>
                    <template is="dom-if" if="[[ _isType('resource') ]]" restamp>
                        <div class="layout horizontal flex">
                            <dude-resource class="flex" resource="{{ propertyValue }}" resources="{{ propertyData }}"></dude-resource>
                        </div>
                    </template>
                    <template is="dom-if" if="[[ _isType('range') ]]" restamp>
                        <div class="layout horizontal flex">
                            <paper-slider value="{{ propertyValue }}" class="flex"
                                min="{{ propertyRange.min }}"
                                max="{{ propertyRange.max }}"
                                step="{{ propertyRange.step }}" pin>
                            </paper-slider>
                        </div>
                    </template>
                    <template is="dom-if" if="[[ _isType('boolean') ]]" restamp>
                        <div class="layout horizontal flex" style="padding-top: 5px; padding-left: 10px">
                            <paper-toggle-button value="{{ propertyValue }}"></paper-toggle-button>
                        </div>
                    </template>
                </template>
            <!--</iron-pages>-->
            <dude-property-reference open$="[[ propertyReference ]]" reference="[[ propertyReference ]]"></dude-property-reference>
        </div>
    </template>
    <script>
        Polymer({

            is: "dude-property",

            listeners: {
                "dude-property-reference-add": "_addReference",
                "dude-property-reference-remove": "_removeReference"
            },

            properties: {

                /**
                 *
                 */
                "propertyName": {
                    "type": String
                },

                /**
                 *
                 */
                "propertyType": {
                    "type": String
                },

                /**
                 *
                 */
                "propertyValue": {
                    "type": Object
                },

                /**
                 *
                 */
                "propertyReference": {
                    "type": Object,
                    "value": null
                },

                /**
                 *
                 */
                "propertyChoice": {
                    "type": Array,
                    "value": []
                },

                /**
                 *
                 */
                "propertyResource": {
                    "type": Object,
                    "value": {}
                },

                /**
                 *
                 */
                "propertyRange": {
                    "type": Object,
                    "value": {min: 1, max: 10, step: 1}
                }
            },

            _isType: function (typename) {
                return this.propertyType === typename;
            },

            /**
             * Called when adding a dude property reference
             * @delegate
             * @private
             */
            _addReference: function () {
                this.set("propertyReference", {
                    "name": "my_reference"
                });
            },

            /**
             * Called when the dude property reference is removed
             * @delegate
             * @private
             */
            _removeReference: function () {
                this.set("propertyReference", null);
            }
        });
    </script>
</dom-module>