<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html">
<link rel="import" href="../dude-hierarchy/dude-hierarchy.html">
<link rel="import" href="../dude-popup/dude-popup.html">
<dom-module id="dude-property-resource">
    <style>
        #openButton {
            background: var(--dude-primary-background-color);
            width: 100%;
            font-family: var(--dude-primary-text-font);
            color: var(--dude-content-text-color);
            border: none;
            padding: 8px;
            margin: 0;
        }

        #popup dude-hierarchy {
            border-radius: 5px;
            padding: 10px;
            width: 300px;
            max-width: 100%;
            background: var(--dude-primary-background-color);
            box-shadow: 0 3px 10px var(--dude-secondary-background-color);
        }

        /**
        Find a proper way to handle screen dimensions
        Popup must not overflow the screen
        */

        #popup dude-hierarchy {
            max-height: 400px;
        }

        @media (max-height: 400px) {
            #popup dude-hierarchy {
                max-height: 200px;
            }
        }

        @media (min-height: 600px) and (max-height: 720px) {
            #popup dude-hierarchy {
                max-height: 400px;
            }
        }

        @media (min-height: 720px) and (max-height: 1080px) {
            #popup dude-hierarchy {
                max-height: 700px;
            }
        }

        @media (min-height: 1080px) {
            #popup dude-hierarchy {
                max-height: 1000px;
            }
        }
    </style>
    <template>
        <paper-button id="openButton" class="layout horizontal" on-click="_openResources">
            <i class$="[[ resource.icon ]]"></i>
            <span hidden$="[[ resource ]]" class="flex">(None)</span>
            <span hidden$="[[ !resource ]]" class="flex">[[ resource.name ]]</span>
        </paper-button>
        <dude-popup id="popup">
            <dude-hierarchy id="hierarchy"
                            items="{{ resources }}"
                            placeholder="Search resources..."
                            on-dude-hierarchy-item-submit="_selectResource"
                            on-dude-hierarchy-blur="_closeResources">
            </dude-hierarchy>
        </dude-popup>
    </template>
    <script>
        Polymer({
            is: "dude-property-resource",

            behaviors: [Polymer.IronA11yKeysBehavior],

            properties: {
                /**
                 * The current selected resource
                 */
                "resource": {
                    "type": Object,
                    "value": null,
                    "notify": true
                },

                /**
                 * The list of resources
                 */
                "resources": {
                    "type": Array,
                    "value": []
                }
            },

            /**
             * Called when the dude property resource is ready
             * @delegate
             */
            ready: function () {
                this.keyEventTarget = this.$["popup"];
                this.addOwnKeyBinding("esc", "_closeResources");
            },

            /**
             * Called when clicking on the resource button
             * Open the resources dialog.
             * @param {CustomEvent} e
             * @param {Number} e.x
             * @param {Number} e.y
             * @delegate
             * @private
             */
            _openResources: function (e) {
                this.$.popup.open(e.x, e.y);
                this.$.hierarchy.focus();
            },

            /**
             * Called when pressing escape
             * Closes the resource popup
             * @delegate
             * @private
             */
            _closeResources: function () {
                this.$.popup.close();
            },

            /**
             * Called when a resource is selected
             * @param {CustomEvent} e
             * @delegate
             * @private
             */
            _selectResource: function (e) {
                this.resource = e.detail.item;
                this.$.popup.close();
            }

        });
    </script>
</dom-module>
